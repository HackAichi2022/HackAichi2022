<html lang="ja">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8">
    <!-- update the version number as needed -->
    <script defer src="/__/firebase/9.10.0/firebase-app-compat.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/9.10.0/firebase-auth-compat.js"></script>
    <script defer src="/__/firebase/9.10.0/firebase-database-compat.js"></script>
    <script defer src="/__/firebase/9.10.0/firebase-firestore-compat.js"></script>
    <script defer src="/__/firebase/9.10.0/firebase-functions-compat.js"></script>
    <script defer src="/__/firebase/9.10.0/firebase-messaging-compat.js"></script>
    <script defer src="/__/firebase/9.10.0/firebase-storage-compat.js"></script>
    <script defer src="/__/firebase/9.10.0/firebase-analytics-compat.js"></script>
    <script defer src="/__/firebase/9.10.0/firebase-remote-config-compat.js"></script>
    <script defer src="/__/firebase/9.10.0/firebase-performance-compat.js"></script>
    <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>

<title>Sample PDF Viewer</title>
<style>
#canvas_container {
    /** pdf表示画面のCSS この辺りはカスタマイズしてください。 */
    height: 100%;
    overflow: auto;
    background: #333;
    text-align: center;
    border: solid 3px;
}
</style>
<script src="//mozilla.github.io/pdf.js/build/pdf.js">
</script>
</head>
<body>
    <div id="pdf_viewer">
        <div id="canvas_container">
            <canvas id="pdf_renderer"></canvas>
        </div>
        <div id="navigation_controls">
            <button id="go_previous">Previous</button>
            <button id="go_next">Next</button>
            <button id="zoom_in">Zoom In</button>
            <button id="zoom_out">Zoom Out</button>
        </div>
    </div>
    <script>
    window.onload  = function() { 
    const storage = firebase.storage();
    const ref = storage.ref('./manual.pdf');
    // var starsRef = storageRef.child('images/stars.jpg');

    // Get the download URL
    ref.getDownloadURL()
    .then((url) => {
    // PDF.js にアクセスするためのショートカット
    var pdfjsLib = window['pdfjs-dist/build/pdf'];
    // PDF.jsを使用するために「workerSrc」プロパティを指定する必要があるため指定
    pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';
    var state = {
        pdf: null,
        // 表示ページ
        currentPage: 1,
        // 倍率 1.0は1倍
        zoom: 1.0
    }
    // ボタンの有効・無効の状態
    const button_pre = document.getElementById("go_previous");
    const button_next = document.getElementById("go_next");
    button_pre.disabled = true
    // PDFの読み込み
    pdfjsLib.getDocument(url).promise.then((pdf) => {
        state.pdf = pdf;
        render();
    });
    // PDFをレンダリングするファンクション
    function render() {
        state.pdf.getPage(state.currentPage).then(function(page) {
            var canvas = document.getElementById("pdf_renderer");
            var ctx = canvas.getContext('2d');
            // 倍率を指定
            var viewport = page.getViewport({scale: state.zoom});
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            // レンダリング
            page.render({
                canvasContext: ctx,
                viewport: viewport
            });
        });
    }
    // 前のPDFのページを表示
    document.getElementById('go_previous')
    .addEventListener('click', (e) => {
        console.log(state.currentPage);
        state.currentPage -= 1;
        if (state.pdf == null || state.currentPage == 1){
            button_pre.disabled = true
           }
        button_next.disabled = false
        render();
    });
    // 次のPDFページを表示
    document.getElementById('go_next')
    .addEventListener('click', (e) => {
        console.log(state.currentPage);
        state.currentPage += 1;
        if (state.pdf == null || state.currentPage == state.pdf._pdfInfo.numPages) {
        button_next.disabled = true
        }
        button_pre.disabled = false
        render();
    });
    // PDFのズームイン（拡大）
    document.getElementById('zoom_in').addEventListener('click', (e) => {
        if(state.pdf == null) return;
        // + 0.5倍
        state.zoom += 0.5;
        render();
    });
     // PDFのズームアウト（拡小）
    document.getElementById('zoom_out').addEventListener('click', (e) => {
        if(state.pdf == null) return;
        // - 0.5倍
        state.zoom -= 0.5;
        render();
    });

});
    }
    </script>
</body>
</html>