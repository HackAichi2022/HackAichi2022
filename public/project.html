<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <script defer src="/__/firebase/9.10.0/firebase-app-compat.js"></script>
    <script
      defer
      src="/__/firebase/9.10.0/firebase-database-compat.js"
    ></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
    <script defer src="js/database.js"></script>
    <title>Project</title>
  </head>
  <body>
    <header class="mdc-top-app-bar">
      <div class="mdc-top-app-bar__row">
        <section
          class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start"
        >
          <span id="project-name" class="mdc-top-app-bar__title">Project</span>
        </section>
      </div>
    </header>
    <main class="mdc-top-app-bar--fixed-adjust">
      <ul id="work-list" class="mdc-list"></ul>
    </main>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        // プロジェクト名はクエリパラメータ経由で受け取る
        const searchParams = new URLSearchParams(location.search)
        if (searchParams.has('projectName')) {
          // ヘッダー部分はプロジェクト名に合わせる
          const projectName = searchParams.get('projectName')
          const projectNameElem = document.getElementById('project-name')
          projectNameElem.textContent = projectName

          // 作業一覧はリストとして表示
          const workListElem = document.getElementById('work-list')
          getChildKeys(projectName).then((keys) => {
            if (keys.length === 0) {
              workListElem.insertAdjacentHTML(
                'beforeend',
                `<li class="mdc-list-item">
                  <span class="mdc-list-item__ripple"></span>
                  <span class="mdc-list-item__text">登録されている作業はありません</span>
                </li>`
              )
            } else {
              keys.forEach((key) => {
                workListElem.insertAdjacentHTML(
                  'beforeend',
                  `<li class="mdc-list-item">
                    <span class="mdc-list-item__ripple"></span>
                    <span class="mdc-list-item__text">${key}</span>
                  </li>`
                )
              })
            }
          })
        } else {
          console.log('query not found')
        }
      })
    </script>
  </body>
</html>
